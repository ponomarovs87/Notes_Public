<!-- TOC -->

# KDE connect –≤ OpenVPN

## üìñ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- [KDE connect –≤ OpenVPN](#kde-connect-–≤-openvpn)
  - [üìñ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ](#-–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)
- [–ü—Ä–æ–±–ª–µ–º–∞](#–ø—Ä–æ–±–ª–µ–º–∞)
- [–¶–µ–ª—å](#—Ü–µ–ª—å)
- [–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ](#–∫—Ä–∞—Ç–∫–æ–µ-—Ä–µ—à–µ–Ω–∏–µ)
- [1 –ö–æ—Ä–æ—Ç–∫–∞—è –∏–¥–µ—è](#1-–∫–æ—Ä–æ—Ç–∫–∞—è-–∏–¥–µ—è)
- [2 –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º OpenVPN](#2-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º-openvpn)
  - [–ü—Ä–∏–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ server.conf (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)](#–ø—Ä–∏–º–µ—Ä-—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞-serverconf-–Ω–∞-—Å–µ—Ä–≤–µ—Ä–µ)
    - [–í server.conf (–∏–ª–∏ /etc/openvpn/server/server.conf)](#–≤-serverconf-–∏–ª–∏-etcopenvpnserverserverconf)
    - [–∏—Å–ø–æ–ª—å–∑—É–µ–º "subnet" ‚Äî –ø—Ä–æ—â–µ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∞–¥—Ä–µ—Å–æ–≤](#–∏—Å–ø–æ–ª—å–∑—É–µ–º-subnet--–ø—Ä–æ—â–µ-–¥–ª—è-—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö-–∞–¥—Ä–µ—Å–æ–≤)
    - [—Ñ–∞–π–ª—ã –ø—É–ª—ã –∏ persist](#—Ñ–∞–π–ª—ã-–ø—É–ª—ã-–∏-persist)
    - [—Ä–∞–∑—Ä–µ—à–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º –æ–±—â–∞—Ç—å—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º (–í–ê–ñ–ù–û –¥–ª—è KDE Connect)](#—Ä–∞–∑—Ä–µ—à–∞–µ–º-–∫–ª–∏–µ–Ω—Ç–∞–º-–æ–±—â–∞—Ç—å—Å—è-–¥—Ä—É–≥-—Å-–¥—Ä—É–≥–æ–º-–≤–∞–∂–Ω–æ-–¥–ª—è-kde-connect)
    - [–∫–∞—Ç–∞–ª–æ–≥ —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤](#–∫–∞—Ç–∞–ª–æ–≥-—Å-–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏-–∫–ª–∏–µ–Ω—Ç–æ–≤)
    - [—É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)](#—É—Ä–æ–≤–µ–Ω—å-–ª–æ–≥–æ–≤-–ø–æ-–∂–µ–ª–∞–Ω–∏—é)
- [3 –°–æ–∑–¥–∞—ë–º –∫–∞—Ç–∞–ª–æ–≥ CCD](#3-—Å–æ–∑–¥–∞—ë–º-–∫–∞—Ç–∞–ª–æ–≥-ccd)
- [4 –ö–∞–∫ –Ω–∞–∑–≤–∞—Ç—å —Ñ–∞–π–ª –≤ ccd –∏ —á—Ç–æ —Ç—É–¥–∞ –ø–∏—Å–∞—Ç—å](#4-–∫–∞–∫-–Ω–∞–∑–≤–∞—Ç—å-—Ñ–∞–π–ª-–≤-ccd-–∏-—á—Ç–æ-—Ç—É–¥–∞-–ø–∏—Å–∞—Ç—å)
- [5 –í–∞–∂–Ω–æ: –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (CN)](#5-–≤–∞–∂–Ω–æ-–∫–ª–∏–µ–Ω—Ç-–¥–æ–ª–∂–µ–Ω-–∏–º–µ—Ç—å-—É–Ω–∏–∫–∞–ª—å–Ω—ã–π-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç-cn)
- [6 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ firewall](#6-–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è-–∏-firewall)
- [7 –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ OpenVPN](#7-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫-openvpn)
      - [–∏–ª–∏](#–∏–ª–∏)
- [8 –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:](#8-–ø—Ä–æ–≤–µ—Ä—å—Ç–µ-–ª–æ–≥–∏)
- [9 –ö–∞–∫ —É–∑–Ω–∞—Ç—å CN –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –Ω–µ –ø–æ–º–Ω–∏—Ç–µ)](#9-–∫–∞–∫-—É–∑–Ω–∞—Ç—å-cn-–∫–ª–∏–µ–Ω—Ç–∞-–µ—Å–ª–∏-–Ω–µ-–ø–æ–º–Ω–∏—Ç–µ)
- [10 –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ KDE Connect –Ω–µ –≤–∏–¥–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ](#10-—á—Ç–æ-–¥–µ–ª–∞—Ç—å-–µ—Å–ª–∏-kde-connect-–Ω–µ-–≤–∏–¥–∏—Ç-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
- [11 –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π –º–∏–Ω–∏‚Äë–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏](#11-–ø—Ä–∏–º–µ—Ä-–ø–æ–ª–Ω–æ–π-–º–∏–Ω–∏–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
- [12 –ü—É–ª –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª-–≤–æ –≤—ã–¥–∞–≤–∞–µ–º—ã—Ö ip (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)](#12-–ø—É–ª-–æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å-–∫–æ–ª-–≤–æ-–≤—ã–¥–∞–≤–∞–µ–º—ã—Ö-ip-–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  - [–ß—Ç–æ —Ä–µ—à–∞–µ—Ç:](#—á—Ç–æ-—Ä–µ—à–∞–µ—Ç)
    - [–ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ :](#–ø—Ä–æ—Å—Ç–æ–µ-—Ä–µ—à–µ–Ω–∏–µ-)
    - [–ù–µ–ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ :](#–Ω–µ–ø—Ä–æ—Å—Ç–æ–µ-—Ä–µ—à–µ–Ω–∏–µ-)
- [P.S. –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–Ω—ã–µ —É—Å–ª–æ–≤–Ω–æ :](#ps-–ø—Ä–∏–º–µ—Ä—ã-–ø–æ–ª–Ω—ã–µ-—É—Å–ª–æ–≤–Ω–æ-)
  - [–∞. –°–∫–æ–ø–∏—Ä—É–π —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∏ –∑–∞–º–µ–Ω–∏ –∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π **/etc/openvpn/server/server.conf** (–∏–ª–∏ /etc/openvpn/server.conf ‚Äî –µ—Å–ª–∏ —É —Ç–µ–±—è –∏–º–µ–Ω–Ω–æ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):](#–∞-—Å–∫–æ–ø–∏—Ä—É–π-—ç—Ç–æ—Ç-–≤–∞—Ä–∏–∞–Ω—Ç-–∏-–∑–∞–º–µ–Ω–∏-–∏–º-—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π-etcopenvpnserverserverconf-–∏–ª–∏-etcopenvpnserverconf--–µ—Å–ª–∏-—É-—Ç–µ–±—è-–∏–º–µ–Ω–Ω–æ-–æ–Ω-–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
  - [–±. –ß—Ç–æ —Ç–µ–ø–µ—Ä—å:](#–±-—á—Ç–æ-—Ç–µ–ø–µ—Ä—å)
  - [–≤. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª—ã –∫–ª–∏–µ–Ω—Ç–æ–≤:](#–≤-—Å–æ–∑–¥–∞–π-—Ñ–∞–π–ª—ã-–∫–ª–∏–µ–Ω—Ç–æ–≤)
  - [–≥. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä:](#–≥-–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏-—Å–µ—Ä–≤–µ—Ä)

---


# –ü—Ä–æ–±–ª–µ–º–∞

```
KDE connect –Ω–µ –≤–∏–¥–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤–Ω—É—Ç—Ä–∏ OpenVPN.
```

# –¶–µ–ª—å
- –∑–∞—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –≤–ø–Ω —á—Ç–æ–±—ã –≤–∏–¥–µ–ª –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ç–∏.
- –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π –ü–ö/–¢–µ–ª–µ—Ñ–æ–Ω/–ü—Ä–∏—Å—Ç–∞–≤–∫—É.



# –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ

*–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥—ë–∂–Ω—ã–π): –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ client-config-dir (CCD) + topology subnet + –≤–∫–ª—é—á—ë–Ω–Ω—ã–π client-to-client.*

*—á—Ç–æ–±—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º (–ü–ö –∏ —Ç–µ–ª–µ—Ñ–æ–Ω) OpenVPN –≤—Å–µ–≥–¥–∞ –≤—ã–¥–∞–≤–∞–ª –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π VPN‚ÄëIP, –∏ —Ç–æ–≥–¥–∞ KDE Connect —Å–º–æ–∂–µ—Ç –æ–±—â–∞—Ç—å—Å—è –ø–æ —ç—Ç–æ–º—É –∞–¥—Ä–µ—Å—É.*

# 1 –ö–æ—Ä–æ—Ç–∫–∞—è –∏–¥–µ—è
–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ OpenVPN –≤–∫–ª—é—á–∞–µ–º **topology subnet** –∏ **server 10.8.0.0 255.255.255.0** (–∏–ª–∏ –≤–∞—à—É –ø–æ–¥—Å–µ—Ç—å).

–£–∫–∞–∑—ã–≤–∞–µ–º :

```
client-config-dir /etc/openvpn/ccd.
```

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª –≤ **/etc/openvpn/ccd/** —Å –∏–º–µ–Ω–µ–º, —Å–æ–≤–ø–∞–¥–∞—é—â–∏–º —Å **Common Name (CN)** –µ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞, –∏ –≤ –Ω—ë–º —Å—Ç—Ä–æ–∫—É **ifconfig-push \<IP> \<netmask>**.

–í–∫–ª—é—á–∞–µ–º **client-to-client** –≤ **server.conf**(–º–æ–∂–µ—Ç –±—ã—Ç—å –¥—Ä—É–≥–æ–π –∫–∞–∫ —É –º–µ–Ω—è –±–æ–ª–µ–µ 2 –≤–ø–Ω –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ), —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç—ã –≤–∏–¥–µ–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –Ω–∞–ø—Ä—è–º—É—é (–¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞).

# 2 –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º OpenVPN

## –ü—Ä–∏–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ server.conf (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
### –í server.conf (–∏–ª–∏ /etc/openvpn/server/server.conf)

```
port 1194 
proto udp
dev tun
```

*–ø–æ—Ä—Ç 1194 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ–≥–¥–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —Å–æ–≤–µ—Ç—É—é –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤ –∏–¥–µ–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–∏—Ç–∞—Ü–∏—é http/https t—Ål —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ*

### –∏—Å–ø–æ–ª—å–∑—É–µ–º "subnet" ‚Äî –ø—Ä–æ—â–µ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∞–¥—Ä–µ—Å–æ–≤

```
topology subnet
server 10.8.0.0 255.255.255.0
```

### —Ñ–∞–π–ª—ã –ø—É–ª—ã –∏ persist

```
ifconfig-pool-persist /etc/openvpn/ipp.txt
```

### —Ä–∞–∑—Ä–µ—à–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º –æ–±—â–∞—Ç—å—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º (–í–ê–ñ–ù–û –¥–ª—è KDE Connect)

```
client-to-client
```

### –∫–∞—Ç–∞–ª–æ–≥ —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤

```
client-config-dir /etc/openvpn/ccd
```
**–¥–µ—Ä–µ–∫—Ç–æ—Ä–∏—è —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ*

### —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
```
verb 3
```

# 3 –°–æ–∑–¥–∞—ë–º –∫–∞—Ç–∞–ª–æ–≥ CCD
```
sudo mkdir -p /etc/openvpn/ccd
sudo chown root:root /etc/openvpn/ccd
sudo chmod 700 /etc/openvpn/ccd
```

**–¥–µ–ª–∞–µ–º –æ–¥–∏–Ω —Ä–∞–∑*

# 4 –ö–∞–∫ –Ω–∞–∑–≤–∞—Ç—å —Ñ–∞–π–ª –≤ ccd –∏ —á—Ç–æ —Ç—É–¥–∞ –ø–∏—Å–∞—Ç—å

–ò–º—è —Ñ–∞–π–ª–∞ –≤ **/etc/openvpn/ccd/** –¥–æ–ª–∂–Ω–æ —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å **Common Name (CN)** –≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–µ—Ä–≤–µ—Ä –≤–∏–¥–∏—Ç –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏. –ï—Å–ª–∏ –≤—ã —Å–æ–∑–¥–∞–≤–∞–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ **Easy‚ÄëRSA, CN** –æ–±—ã—á–Ω–æ –∑–∞–¥–∞–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä pc-home –∏–ª–∏ phone-android).

**—Ñ–∞–π–ª—ã –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ **nano***

–ü—Ä–∏–º–µ—Ä:

* –¥–∞—Ç—å –ü–ö IP 10.8.0.10, —Ç–µ–ª–µ—Ñ–æ–Ω—É 10.8.0.11.

–§–∞–π–ª **/etc/openvpn/ccd/pc-home**:

```
ifconfig-push 10.8.0.10 255.255.255.0
```

–§–∞–π–ª **/etc/openvpn/ccd/phone-android**:

```
ifconfig-push 10.8.0.11 255.255.255.0
```

* –ï—Å–ª–∏ –≤–∞—à —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—É—é —Ç–æ–ø–æ–ª–æ–≥–∏—é net30, —Ñ–æ—Ä–º–∞—Ç ifconfig-push –¥—Ä—É–≥–æ–π (–Ω—É–∂–Ω–æ 2 IP). –ü–æ—ç—Ç–æ–º—É —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é topology subnet ‚Äî —ç—Ç–æ –ø—Ä–æ—â–µ –¥–ª—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö /24 —Å–µ—Ç–µ–π.

# 5 –í–∞–∂–Ω–æ: –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (CN)
–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –Ω–∞–¥—ë–∂–µ–Ω, –∫–æ–≥–¥–∞ —É –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –µ—Å—Ç—å —Å–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º CN. –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∏–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –æ–ø—Ü–∏—è duplicate-cn, —Ç–æ CCD –ø–æ CN —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç (–Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ‚Äî –æ–¥–∏–Ω CN). –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ:

* –ª—É—á—à–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –ü–ö –∏ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é),

* –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å client-connect —Å–∫—Ä–∏–ø—Ç –∏ –ª–æ–≥–∏–∫—É –ø–æ username (—Å–ª–æ–∂–Ω–µ–µ).

# 6 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ firewall

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤–∫–ª—é—á—ë–Ω —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ (–¥–ª—è Linux):

—á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ **/etc/sysctl.conf: net.ipv4.ip_forward=1**:

```
sudo sysctl -w net.ipv4.ip_forward=1
```

* –ï—Å–ª–∏ —É –≤–∞—Å **firewall (iptables/nftables)**, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ —Ç—Ä–∞—Ñ–∏–∫ –≤–Ω—É—Ç—Ä–∏ **tun** –∏ –º–µ–∂–¥—É **tun** –∏ –ª–æ–∫–∞–ª–æ–π –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. –ù–æ –ø—Ä–∏ **client-to-client** —Ç—Ä–∞—Ñ–∏–∫ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏–¥—ë—Ç –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –æ–±—ã—á–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ **NAT**.

* –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ **firewall** –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç **multicast/broadcast**, –µ—Å–ª–∏ **KDE Connect** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏. –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –ø–æ IP –≤—Ä—É—á–Ω—É—é (–≤ KDE Connect –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ –∞–¥—Ä–µ—Å—É/–∫–æ–¥—É).

# 7 –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ OpenVPN

–ü–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:

* systemd: –∏–º—è —Ñ–∞–π–ª–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å *openvpn-server@server.service* –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ *openvpn.service*

–µ—Å–ª–∏ –≤–∞—à –∫–æ–Ω—Ñ–∏–≥ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **server.conf**:

```
sudo systemctl restart openvpn@server
```

#### –∏–ª–∏

```
sudo systemctl restart openvpn-server
```

# 8 –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```
sudo journalctl -u openvpn@server -f
```
* –∏–ª–∏ **/var/log/syslog** **/var/log/openvpn.log** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Å—Ç–µ–º—ã


# 9 –ö–∞–∫ —É–∑–Ω–∞—Ç—å CN –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –Ω–µ –ø–æ–º–Ω–∏—Ç–µ)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (client.crt), –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å CN —Ç–∞–∫:

```
openssl x509 -in client.crt -noout -subject
```

–ø—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
```
subject= /CN=pc-home
```

–ò–º–µ–Ω–Ω–æ —ç—Ç–æ –∏–º—è –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∏–º—è —Ñ–∞–π–ª–∞ –≤ ccd.

# 10 –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ KDE Connect –Ω–µ –≤–∏–¥–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ VPN –∏ –ø–æ–ª—É—á–∏–ª–∏ —Ç–µ IP, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∑–∞–¥–∞–ª–∏ (10.8.0.10 –∏ 10.8.0.11).

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–µ–∂–¥—É –Ω–∏–º–∏ –ø–∏–Ω–≥—É–µ—Ç—Å—è IP: —Å –ü–ö

```
 ping 10.8.0.11.
```

–ï—Å–ª–∏ –ø–∏–Ω–≥ –µ—Å—Ç—å, –Ω–æ KDE Connect –Ω–µ –≤–∏–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–æ–º ‚Äî –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ KDE Connect –Ω–∞ –æ–¥–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ IP (–≤–≤–æ–¥ IP –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–∫–æ–¥).

–ï—Å–ª–∏ –ø–∏–Ω–≥–∞ –Ω–µ—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ client-to-client, ip_forward –∏ –ø—Ä–∞–≤–∏–ª–∞ —Ñ–∞–µ—Ä–≤–æ–ª–∞.

# 11 –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π –º–∏–Ω–∏‚Äë–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

server.conf (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ):
```
dev tun
proto udp
port 1194
topology subnet
server 10.8.0.0 255.255.255.0
ifconfig-pool-persist /etc/openvpn/ipp.txt
client-to-client
client-config-dir /etc/openvpn/ccd
verb 3

...
```

ccd/pc-home:
```
ifconfig-push 10.8.0.10 255.255.255.0
```

ccd/phone-android:
```
ifconfig-push 10.8.0.11 255.255.255.0
```


# 12 –ü—É–ª –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª-–≤–æ –≤—ã–¥–∞–≤–∞–µ–º—ã—Ö ip (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

## –ß—Ç–æ —Ä–µ—à–∞–µ—Ç:

* –∫—Ç–æ –ø–µ—Ä–≤—ã–π –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è —Ç–æ—Ç –∏ –ø–æ–ª—É—á–∏—Ç 10.8.0.1
* –µ—Å–ª–∏ kde connect –ø–æ–¥–∫–ª—é—á–µ–Ω –ø–æ ip –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ç–µ—Ä—è–µ—Ç
  
### –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ :

* –≤—ã–¥–∞–π—Ç–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∞–¥—Ä–µ—Å–∞ —Å –∫–æ–Ω—Ü–∞ (–µ—Å–ª–∏ —É –≤–∞—Å –º–µ–Ω–µ–µ 255 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—Å–µ –æ–∫)
  

–ø—Ä–∏–º–µ—Ä:

ccd/phone-android:
```
ifconfig-push 10.8.0.199 255.255.255.0
```
### –ù–µ–ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ :

–ö–æ–º–∞–Ω–¥–∞
```
server 10.8.0.0 255.255.255.0
```

—É–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –ø—É–ª –∞–¥—Ä–µ—Å–æ–≤.

–ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å —Å–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª–∏–Ω–Ω—É—é —Ñ–æ—Ä–º—É, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
mode server
tls-server
ifconfig 10.8.0.1 255.255.255.0
ifconfig-pool 10.8.0.10 10.8.0.150
```

–Ω–æ —ç—Ç–æ –∑–∞–º–µ–Ω—è–µ—Ç server.

*–¢–∞–∫ —á—Ç–æ –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å server –∏ —É–±—Ä–∞—Ç—å ifconfig-pool.*

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ:

```
sudo systemctl restart openvpn@server
sudo systemctl status openvpn@server
```

**–ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å active (running) ‚Äî –≤—Å—ë –æ–∫*

# P.S. –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–Ω—ã–µ —É—Å–ª–æ–≤–Ω–æ :


## –∞. –°–∫–æ–ø–∏—Ä—É–π —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∏ –∑–∞–º–µ–Ω–∏ –∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π **/etc/openvpn/server/server.conf** (–∏–ª–∏ /etc/openvpn/server.conf ‚Äî –µ—Å–ª–∏ —É —Ç–µ–±—è –∏–º–µ–Ω–Ω–æ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):

```
############################################################
# OpenVPN Server Configuration (TCP/3000)
############################################################

port 3000
proto tcp
dev tun

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –≥—Ä—É–ø–ø–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
user nobody
group nogroup
persist-key
persist-tun

############################################################
# –°–µ—Ç—å VPN
############################################################
topology subnet
server 10.8.0.0 255.255.255.0

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É–ª IP-–∞–¥—Ä–µ—Å–æ–≤ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –ø–æ–ª–µ–∑–Ω–æ)
ifconfig-pool-persist /etc/openvpn/ipp.txt

# –†–∞–∑—Ä–µ—à–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞ (–¥–ª—è KDE Connect –∏ —Ç.–ø.)
client-to-client

# –ö–∞—Ç–∞–ª–æ–≥ —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ IP)
client-config-dir /etc/openvpn/ccd

############################################################
# –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ DNS
############################################################
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ VPN
push "redirect-gateway def1 bypass-dhcp"

# DNS Cloudflare
push "dhcp-option DNS 1.1.1.1"
push "dhcp-option DNS 1.0.0.1"

# (–ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –º–∞—Ä—à—Ä—É—Ç—ã)
# push "route 0.0.0.0 128.0.0.0 10.8.0.1"
# push "route 128.0.0.0 128.0.0.0 10.8.0.1"

############################################################
# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TCP
############################################################
# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ MSS –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã TCP-over-TCP
mssfix 1200

############################################################
# –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
############################################################
tls-crypt ...openvpn/server/tc.key
tls-version-min 1.2
ecdh-curve prime256v1
data-ciphers AES-256-GCM:AES-128-GCM
data-ciphers-fallback AES-256-GCM
auth SHA256

############################################################
# –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
############################################################
ca      ...openvpn/server/ca.crt
cert    ...openvpn/server/server.crt
key     ...openvpn/server/server.key
dh      ...openvpn/server/dh.pem

############################################################
# –¢–∞–π–º–∏–Ω–≥–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
############################################################
keepalive 10 120
verb 3
status   ...openvpn/server/openvpn-status.log

############################################################
# –ö–æ–Ω–µ—Ü –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
############################################################
```

## –±. –ß—Ç–æ —Ç–µ–ø–µ—Ä—å:
–£–±–µ–¥–∏—Å—å, —á—Ç–æ –∫–∞—Ç–∞–ª–æ–≥ CCD —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
```
sudo mkdir -p /etc/openvpn/ccd
sudo chmod 700 /etc/openvpn/ccd
```

## –≤. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª—ã –∫–ª–∏–µ–Ω—Ç–æ–≤:

```
/etc/openvpn/ccd/pc-user
/etc/openvpn/ccd/phone-user
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
```
ifconfig-push 10.8.0.199 255.255.255.0
```
–∏
```
ifconfig-push 10.8.0.198 255.255.255.0
```
## –≥. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä:
```
sudo systemctl restart openvpn@server-tcp587
sudo systemctl status openvpn@server-tcp587
```

* –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å active (running) ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç.
* –ü—Ä–æ–≤–µ—Ä—å openvpn-status.log, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∏–ª–∏ —Å–≤–æ–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ IP.
<!-- /TOC -->